function Approval(){this.dataCount=""}Approval.prototype={throttle:function(a,e){clearTimeout(a.tId),a.tId=setTimeout(function(){a.call(e)},200)},touchThrottle:function(a,e,t){var n=null,s=new Date;return function(){var i=this,o=arguments,l=new Date;clearTimeout(n),l-s>=t?(a.apply(i,o),s=l):n=setTimeout(function(){a.apply(i,o)},e)}},getData:function(a,e,t){var n=this;$.ajax({url:getRoothPath+"/ddExpenses/expenseInfo/myExpenseList",data:{userID:a,pageNum:e,pageSize:t},success:function(a){if("{}"===JSON.stringify(a))return $my.messageInfo.html("暂无数据").fadeIn("fast").delay("1000").fadeOut("slow"),!1;switch(a.status){case"true":var e=a.info;if(n.dataCount=e.dataCount,"{}"===JSON.stringify(e))return void $my.messageInfo.html("返回信息为空").fadeIn("fast").delay("1000").fadeOut("slow");var s=e.data;if(!s.length)return $(".loading").hide(),void $my.messageInfo.html("暂无信息").fadeIn("fast").delay("1000").fadeOut("slow");s.length<t&&($(".loading").hide(),$my.lodingText.classList.add("lodingText_show")),n.renderElement(s);break;case"failure":$my.messageInfo.html("查询错误").fadeIn("fast").delay("1000").fadeOut("slow")}}})},renderElement:function(a){for(var e="",t="",n="",s="",i=0;i<a.length;i++){var o=a[i].expenseState,l=a[i].reviewType;switch(o){case"审核中":t='<li class="underReview" data-detailid='+a[i].id+" data-reviewid="+a[i].reviewID+">",n='<p class="status"><span class="glyphicon glyphicon-exclamation-sign my-icon"></span>&nbsp;&nbsp;<span>'+o+"</span></p>";break;case"已通过":t='<li class="passed" data-detailid='+a[i].id+" data-reviewid="+a[i].reviewID+">",n='<p class="status"><span class="iconfont icon-tongguo my-icon"></span>&nbsp;&nbsp;<span>'+o+"</span></p>";break;case"已拒绝":t='<li class="refused" data-detailid='+a[i].id+" data-reviewid="+a[i].reviewID+">",n='<p class="status"><span class="iconfont icon-ttpodicon my-icon"></span>&nbsp;&nbsp;<span>'+o+"</span></p>"}switch(l){case"待我审批":s="backlog"}e+=""+t,e+='<div class="container-fluid myContainer">',e+='<div class="row my-row">',e+='<div class="col-xs-3 col-sm-3 col-md-3 my-col '+s+'">',e+='<span class="peopleName nowrap text-center">'+a[i].ExpenseUserName+"</span>",e+="</div>",e+='<div class="col-xs-6 col-sm-6 col-md-6 my-col">',e+='<div class="inTop">',e+='<p class="nowrap">'+a[i].itemName+"</p>",e+="</div>",e+='<div class="inBottom">',e+='<p class="count">￥<span>'+a[i].expenseTotal+"</span></p>",e+="</div>",e+="</div>",e+='<div class="col-xs-3 col-sm-3 col-md-3 my-col text-right">',e+='<div class="inTop">',e+=""+n,e+="</div>",e+='<div class="inBottom">',e+="<span>"+a[i].updateTime.substring(6)+" <span></span></span>",e+="</div></div></div></div></li>"}$($my.inWrap).append(e),$my.flag=!1},scrollEvent:function(){var a=$my.loadingWrap.getBoundingClientRect();if(!$my.flag){if(!(a.top<$my.vpHeight&&a.bottom>=0))return;if($my.flag=!0,++$my.num>parseInt(approval.dataCount/pageSize)||$my.num==parseInt(approval.dataCount/pageSize)&&approval.dataCount%pageSize==0)return $(".loading").hide(),$my.lodingText.classList.add("lodingText_show"),!1;approval.getData($my.userID,$my.num,pageSize)}},viewDetail:function(){var a=function(){var a=this.dataset.detailid,e=this.dataset.reviewid,t="";t=this.querySelector(".backlog")?"1":"0",window.location.href="bbsp.html?detailid="+a+"&reviewid="+e+"&status="+t};$($my.inWrap).on("click","li",function(e){e.preventDefault(),e.stopPropagation(),approval.throttle(a,this)})}};var approval=new Approval;$(function(){window.$my={messageInfo:$(".messageInfo"),userID:sessionStorage.getItem("ddUserID"),loadingWrap:document.querySelector("#loadingWrap"),lodingText:document.querySelector("#lodingText"),inWrap:document.querySelector(".inWrap"),wrap:document.querySelector(".wrap"),vpHeight:document.documentElement.clientHeight,num:0,flag:!1},approval.getData($my.userID,0,pageSize),window.addEventListener("touchmove",approval.touchThrottle(approval.scrollEvent,500,1e3)),approval.viewDetail()});